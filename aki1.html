<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AKI Learning Hub - Interactive 3D Education</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #1e3c72 100%);
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 40px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 3.5rem;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .nav-btn {
            padding: 15px 30px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            border-radius: 50px;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.4);
            filter: brightness(1.1);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            align-items: start;
        }

        .canvas-container {
            position: relative;
            height: 600px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        #kidney-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
        }

        .control-btn {
            display: block;
            margin-bottom: 10px;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .control-btn:hover,
        .control-btn.active {
            background: rgba(255, 107, 107, 0.8);
            border-color: #ff6b6b;
        }

        .info-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 600px;
            overflow-y: auto;
        }

        .info-section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .info-section.active {
            display: block;
        }

        .info-section h2 {
            color: #4ecdc4;
            margin-bottom: 20px;
            font-size: 1.8rem;
            border-bottom: 2px solid #4ecdc4;
            padding-bottom: 10px;
        }

        .info-section h3 {
            color: #ff6b6b;
            margin: 20px 0 10px 0;
            font-size: 1.3rem;
        }

        .info-section p, .info-section li {
            line-height: 1.6;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .info-section ul {
            margin-left: 20px;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4ecdc4;
            display: block;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        .stage-indicator {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            gap: 10px;
        }

        .stage {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            border-radius: 10px;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .stage.stage-1 {
            background: linear-gradient(45deg, #ffd93d, #ff9a56);
            color: #333;
        }

        .stage.stage-2 {
            background: linear-gradient(45deg, #ff9a56, #ff6b6b);
            color: white;
        }

        .stage.stage-3 {
            background: linear-gradient(45deg, #ff6b6b, #c44569);
            color: white;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }

        .loading-content {
            text-align: center;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid #4ecdc4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .pulse-animation {
            animation: pulse 2s infinite;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .nav-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .canvas-container {
                height: 400px;
            }
        }

        .kidney-damage {
            background: linear-gradient(45deg, #ff6b6b, #c44569);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid #ff4757;
        }

        .normal-function {
            background: linear-gradient(45deg, #4ecdc4, #44bd87);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid #2ecc71;
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="spinner"></div>
            <h2>Loading 3D Kidney Model...</h2>
            <p>Initializing interactive learning experience</p>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>Acute Kidney Injury Learning Hub</h1>
            <p>Interactive 3D Education for Nursing Students</p>
            <div class="nav-buttons">
                <button class="nav-btn" onclick="showSection('overview')">AKI Overview</button>
                <button class="nav-btn" onclick="showSection('causes')">Causes & Types</button>
                <button class="nav-btn" onclick="showSection('stages')">Staging System</button>
                <button class="nav-btn" onclick="showSection('nursing')">Nursing Care</button>
                <button class="nav-btn" onclick="showSection('treatment')">Treatment</button>
            </div>
        </div>

        <div class="main-content">
            <div class="canvas-container">
                <canvas id="kidney-canvas"></canvas>
                <div class="controls">
                    <button class="control-btn active" onclick="showKidneyState('normal')">Normal Kidney</button>
                    <button class="control-btn" onclick="showKidneyState('aki-stage1')">AKI Stage 1</button>
                    <button class="control-btn" onclick="showKidneyState('aki-stage2')">AKI Stage 2</button>
                    <button class="control-btn" onclick="showKidneyState('aki-stage3')">AKI Stage 3</button>
                    <button class="control-btn" onclick="toggleRotation()">Toggle Rotation</button>
                </div>
            </div>

            <div class="info-panel">
                <div id="overview" class="info-section active">
                    <h2>Acute Kidney Injury Overview</h2>
                    <p><strong>Acute kidney injury (AKI)</strong> is a sudden decrease in kidney function that develops within hours to days. It was previously known as acute renal failure (ARF).</p>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <span class="stat-number">7%</span>
                            <div class="stat-label">Hospital Admissions</div>
                        </div>
                        <div class="stat-card">
                            <span class="stat-number">30%</span>
                            <div class="stat-label">ICU Admissions</div>
                        </div>
                        <div class="stat-card">
                            <span class="stat-number">48hrs</span>
                            <div class="stat-label">Typical Development</div>
                        </div>
                    </div>

                    <div class="normal-function">
                        <h3>Normal Kidney Function</h3>
                        <p>• Filters waste products from blood<br>
                        • Maintains fluid and electrolyte balance<br>
                        • Regulates blood pressure<br>
                        • Produces erythropoietin<br>
                        • Maintains acid-base balance</p>
                    </div>

                    <div class="kidney-damage">
                        <h3>What Happens in AKI?</h3>
                        <p>• Sudden loss of filtration ability<br>
                        • Waste product accumulation<br>
                        • Fluid and electrolyte imbalances<br>
                        • Potential multi-organ effects<br>
                        • Risk of chronic kidney disease</p>
                    </div>
                </div>

                <div id="causes" class="info-section">
                    <h2>Causes & Classification</h2>
                    <p>AKI is traditionally classified into three categories based on the location of the problem:</p>

                    <h3>1. Prerenal AKI (Most Common)</h3>
                    <p><strong>Cause:</strong> Decreased blood flow to kidneys</p>
                    <ul>
                        <li>Hypovolemia (dehydration, blood loss)</li>
                        <li>Hypotension (sepsis, cardiogenic shock)</li>
                        <li>Renal artery stenosis</li>
                        <li>Heart failure</li>
                        <li>Medications (NSAIDs, ACE inhibitors)</li>
                    </ul>

                    <h3>2. Intrinsic Renal AKI</h3>
                    <p><strong>Cause:</strong> Direct kidney tissue damage</p>
                    <ul>
                        <li>Acute tubular necrosis (ATN)</li>
                        <li>Glomerulonephritis</li>
                        <li>Interstitial nephritis</li>
                        <li>Nephrotoxic medications</li>
                        <li>Rhabdomyolysis</li>
                    </ul>

                    <h3>3. Postrenal AKI</h3>
                    <p><strong>Cause:</strong> Urinary tract obstruction</p>
                    <ul>
                        <li>Kidney stones</li>
                        <li>Benign prostatic hypertrophy</li>
                        <li>Tumors</li>
                        <li>Urethral strictures</li>
                        <li>Blocked urinary catheter</li>
                    </ul>
                </div>

                <div id="stages" class="info-section">
                    <h2>KDIGO Staging System</h2>
                    <p>The Kidney Disease: Improving Global Outcomes (KDIGO) criteria is the most widely used staging system for AKI:</p>

                    <div class="stage-indicator">
                        <div class="stage stage-1" onclick="highlightStage(1)">
                            <div>STAGE 1</div>
                            <small>Mild</small>
                        </div>
                        <div class="stage stage-2" onclick="highlightStage(2)">
                            <div>STAGE 2</div>
                            <small>Moderate</small>
                        </div>
                        <div class="stage stage-3" onclick="highlightStage(3)">
                            <div>STAGE 3</div>
                            <small>Severe</small>
                        </div>
                    </div>

                    <h3>Stage 1 (Mild AKI)</h3>
                    <ul>
                        <li>Serum creatinine increase ≥0.3 mg/dL within 48 hours, OR</li>
                        <li>Serum creatinine increase ≥1.5x baseline within 7 days, OR</li>
                        <li>Urine output <0.5 mL/kg/h for 6-12 hours</li>
                    </ul>

                    <h3>Stage 2 (Moderate AKI)</h3>
                    <ul>
                        <li>Serum creatinine increase 2.0-2.9x baseline, OR</li>
                        <li>Urine output <0.5 mL/kg/h for ≥12 hours</li>
                    </ul>

                    <h3>Stage 3 (Severe AKI)</h3>
                    <ul>
                        <li>Serum creatinine increase ≥3.0x baseline, OR</li>
                        <li>Serum creatinine ≥4.0 mg/dL, OR</li>
                        <li>Urine output <0.3 mL/kg/h for ≥24 hours, OR</li>
                        <li>Anuria for ≥12 hours, OR</li>
                        <li>Need for renal replacement therapy</li>
                    </ul>
                </div>

                <div id="nursing" class="info-section">
                    <h2>Nursing Care & Assessment</h2>
                    
                    <h3>Priority Nursing Diagnoses</h3>
                    <ul>
                        <li><strong>Excess fluid volume</strong> related to decreased urine output</li>
                        <li><strong>Risk for electrolyte imbalance</strong> related to impaired kidney function</li>
                        <li><strong>Altered thought processes</strong> related to uremic toxins</li>
                        <li><strong>Risk for infection</strong> related to invasive procedures</li>
                        <li><strong>Deficient knowledge</strong> regarding disease management</li>
                    </ul>

                    <h3>Critical Assessments</h3>
                    <ul>
                        <li><strong>Vital Signs:</strong> Monitor for hypotension, tachycardia, fever</li>
                        <li><strong>Intake & Output:</strong> Strict monitoring (hourly in acute phase)</li>
                        <li><strong>Daily Weights:</strong> Same scale, same time, same clothing</li>
                        <li><strong>Edema Assessment:</strong> Peripheral, pulmonary, sacral</li>
                        <li><strong>Neurological Status:</strong> Confusion, lethargy, seizures</li>
                        <li><strong>Laboratory Values:</strong> Creatinine, BUN, electrolytes</li>
                    </ul>

                    <h3>Nursing Interventions</h3>
                    <ul>
                        <li>Monitor serum creatinine and estimated GFR trends</li>
                        <li>Strict fluid balance documentation</li>
                        <li>Medication reconciliation (avoid nephrotoxic drugs)</li>
                        <li>Skin care and infection prevention</li>
                        <li>Patient and family education</li>
                        <li>Collaborate with dietitian for dietary restrictions</li>
                    </ul>

                    <h3>Red Flag Symptoms</h3>
                    <div class="kidney-damage">
                        <p><strong>Call physician immediately if:</strong><br>
                        • Urine output <0.5 mL/kg/hr for >6 hours<br>
                        • Rapidly rising creatinine<br>
                        • Severe hyperkalemia (K+ >6.0)<br>
                        • Signs of fluid overload with respiratory distress<br>
                        • Altered mental status</p>
                    </div>
                </div>

                <div id="treatment" class="info-section">
                    <h2>Treatment & Management</h2>

                    <h3>General Principles</h3>
                    <ul>
                        <li><strong>Identify and treat underlying cause</strong></li>
                        <li><strong>Optimize fluid status</strong> - careful balance</li>
                        <li><strong>Avoid nephrotoxic medications</strong></li>
                        <li><strong>Monitor and correct electrolyte imbalances</strong></li>
                        <li><strong>Nutritional support</strong> to prevent catabolism</li>
                    </ul>

                    <h3>Specific Treatments by Cause</h3>
                    <ul>
                        <li><strong>Prerenal:</strong> Fluid resuscitation, treat hypotension</li>
                        <li><strong>Intrinsic:</strong> Remove nephrotoxins, treat inflammation</li>
                        <li><strong>Postrenal:</strong> Relieve obstruction (catheter, stents)</li>
                    </ul>

                    <h3>Renal Replacement Therapy (RRT)</h3>
                    <p><strong>Indications for Dialysis:</strong></p>
                    <ul>
                        <li>Refractory hyperkalemia (K+ >6.5)</li>
                        <li>Severe acidosis (pH <7.15)</li>
                        <li>Fluid overload with pulmonary edema</li>
                        <li>Uremic complications (pericarditis, encephalopathy)</li>
                        <li>Severe uremia (BUN >100)</li>
                    </ul>

                    <h3>Dietary Management</h3>
                    <div class="normal-function">
                        <p><strong>Nutritional Guidelines:</strong><br>
                        • High calorie intake (prevent catabolism)<br>
                        • Protein restriction if severe uremia<br>
                        • Potassium restriction (avoid bananas, oranges)<br>
                        • Sodium restriction (prevent fluid retention)<br>
                        • Fluid restriction: output + 500mL/day</p>
                    </div>

                    <h3>Prevention Strategies</h3>
                    <ul>
                        <li>Maintain adequate hydration</li>
                        <li>Avoid nephrotoxic medications when possible</li>
                        <li>Monitor high-risk patients closely</li>
                        <li>Early recognition and intervention</li>
                        <li>Optimize management of chronic conditions</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Three.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script>
        // Global variables
        let scene, camera, renderer, kidney, nephron, controls;
        let isRotating = true;
        let currentState = 'normal';
        let animationId;

        // Initialize the 3D scene
        function init3DScene() {
            const canvas = document.getElementById('kidney-canvas');
            const container = canvas.parentElement;

            // Create scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a1a2a);

            // Create camera
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(5, 3, 5);

            // Create renderer
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;

            // Add lights
            addLights();

            // Create kidney model
            createKidneyModel();

            // Add particles for atmosphere
            addParticles();

            // Start animation loop
            animate();

            // Handle window resize
            window.addEventListener('resize', onWindowResize);
        }

        function addLights() {
            // Ambient light
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);

            // Main directional light
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);

            // Point lights for dramatic effect
            const pointLight1 = new THREE.PointLight(0x4ecdc4, 0.8, 100);
            pointLight1.position.set(-5, 5, 0);
            scene.add(pointLight1);

            const pointLight2 = new THREE.PointLight(0xff6b6b, 0.6, 100);
            pointLight2.position.set(5, -5, 0);
            scene.add(pointLight2);
        }

        function createKidneyModel() {
            // Create kidney group
            kidney = new THREE.Group();

            // Main kidney body (bean shape approximation)
            const kidneyGeometry = createKidneyGeometry();
            const kidneyMaterial = new THREE.MeshPhongMaterial({
                color: 0xd2691e,
                shininess: 30,
                transparent: true,
                opacity: 0.9
            });
            
            const kidneyMesh = new THREE.Mesh(kidneyGeometry, kidneyMaterial);
            kidneyMesh.castShadow = true;
            kidneyMesh.receiveShadow = true;
            kidney.add(kidneyMesh);

            // Create nephron structures
            createNephronStructures();

            // Add kidney to scene
            scene.add(kidney);
            
            // Position camera to look at kidney
            camera.lookAt(kidney.position);
        }

        function createKidneyGeometry() {
            // Create a kidney-like shape using combined geometries
            const shape = new THREE.Shape();
            
            // Draw kidney outline
            shape.moveTo(0, 0);
            shape.bezierCurveTo(0, 1, 1.5, 1.5, 2, 1);
            shape.bezierCurveTo(2.3, 0.5, 2.3, -0.5, 2, -1);
            shape.bezierCurveTo(1.5, -1.5, 0, -1, 0, 0);
            
            // Add indentation for hilum
            const hole = new THREE.Path();
            hole.moveTo(1.8, 0.2);
            hole.bezierCurveTo(1.6, 0.3, 1.6, -0.3, 1.8, -0.2);
            hole.bezierCurveTo(2.0, -0.1, 2.0, 0.1, 1.8, 0.2);
            shape.holes.push(hole);

            const extrudeSettings = {
                depth: 1,
                bevelEnabled: true,
                bevelSegments: 2,
                steps: 2,
                bevelSize: 0.1,
                bevelThickness: 0.1
            };

            return new THREE.ExtrudeGeometry(shape, extrudeSettings);
        }

        function createNephronStructures() {
            // Create simplified nephron representations
            const nephronGroup = new THREE.Group();

            // Create multiple nephron units
            for (let i = 0; i < 50; i++) {
                const nephronUnit = createSingleNephron();
                nephronUnit.position.set(
                    (Math.random() - 0.5) * 3,
                    (Math.random() - 0.5) * 2,
                    (Math.random() - 0.5) * 1.5
                );
                nephronUnit.scale.setScalar(0.1 + Math.random() * 0.05);
                nephronGroup.add(nephronUnit);
            }

            kidney.add(nephronGroup);
            nephron = nephronGroup;
        }

        function createSingleNephron() {
            const nephronUnit = new THREE.Group();

            // Glomerulus (sphere)
            const glomerulusGeometry = new THREE.SphereGeometry(0.3, 8, 6);
            const glomerulusMaterial = new THREE.MeshPhongMaterial({
                color: 0xff6b6b,
                transparent: true,
                opacity: 0.8
            });
            const glomerulus = new THREE.Mesh(glomerulusGeometry, glomerulusMaterial);
            nephronUnit.add(glomerulus);

            // Bowman's capsule (larger transparent sphere)
            const capsuleGeometry = new THREE.SphereGeometry(0.4, 8, 6);
            const capsuleMaterial = new THREE.MeshPhongMaterial({
                color: 0x4ecdc4,
                transparent: true,
                opacity: 0.3,
                wireframe: true
            });
            const capsule = new THREE.Mesh(capsuleGeometry, capsuleMaterial);
            nephronUnit.add(capsule);

            // Tubule (curved tube)
            const tubuleGeometry = new THREE.CylinderGeometry(0.05, 0.05, 2, 8);
            const tubuleMaterial = new THREE.MeshPhongMaterial({
                color: 0x45b7d1,
                transparent: true,
                opacity: 0.7
            });
            const tubule = new THREE.Mesh(tubuleGeometry, tubuleMaterial);
            tubule.position.set(0, -1, 0);
            tubule.rotation.z = Math.PI / 6;
            nephronUnit.add(tubule);

            return nephronUnit;
        }

        function addParticles() {
            // Create floating particles for atmosphere
            const particleGeometry = new THREE.BufferGeometry();
            const particleCount = 200;
            const positions = new Float32Array(particleCount * 3);

            for (let i = 0; i < particleCount * 3; i++) {
                positions[i] = (Math.random() - 0.5) * 20;
            }

            particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

            const particleMaterial = new THREE.PointsMaterial({
                color: 0x4ecdc4,
                size: 0.1,
                transparent: true,
                opacity: 0.6
            });

            const particles = new THREE.Points(particleGeometry, particleMaterial);
            scene.add(particles);
        }

        function animate() {
            animationId = requestAnimationFrame(animate);

            // Rotate kidney if rotation is enabled
            if (isRotating && kidney) {
                kidney.rotation.y += 0.005;
                kidney.rotation.x += 0.002;
            }

            // Animate particles
            const time = Date.now() * 0.001;
            if (nephron) {
                nephron.children.forEach((unit, index) => {
                    unit.position.y += Math.sin(time + index * 0.1) * 0.001;
                });
            }

            renderer.render(scene, camera);
        }

        function onWindowResize() {
            const container = document.getElementById('kidney-canvas').parentElement;
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        // Control functions
        function showKidneyState(state) {
            currentState = state;
            
            // Update active button
            document.querySelectorAll('.control-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (!kidney) return;

            // Change kidney appearance based on state
            const kidneyMesh = kidney.children[0];
            const nephronUnits = nephron.children;

            switch (state) {
                case 'normal':
                    kidneyMesh.material.color.setHex(0xd2691e); // Normal brown
                    kidneyMesh.material.opacity = 0.9;
                    nephronUnits.forEach(unit => {
                        unit.children[0].material.color.setHex(0xff6b6b); // Normal red glomeruli
                        unit.children[1].material.opacity = 0.3; // Normal capsule
                        unit.children[2].material.color.setHex(0x45b7d1); // Normal blue tubules
                    });
                    break;
                    
                case 'aki-stage1':
                    kidneyMesh.material.color.setHex(0xb8860b); // Slightly darker
                    kidneyMesh.material.opacity = 0.85;
                    nephronUnits.forEach(unit => {
                        unit.children[0].material.color.setHex(0xff4757); // Slightly inflamed
                        unit.children[1].material.opacity = 0.4; // More visible capsule
                        unit.children[2].material.color.setHex(0x3742fa); // Darker tubules
                    });
                    break;
                    
                case 'aki-stage2':
                    kidneyMesh.material.color.setHex(0x8b4513); // Darker brown
                    kidneyMesh.material.opacity = 0.8;
                    nephronUnits.forEach(unit => {
                        unit.children[0].material.color.setHex(0xff3838); // More inflamed
                        unit.children[1].material.opacity = 0.5; // More swollen
                        unit.children[2].material.color.setHex(0x2f3542); // Much darker tubules
                    });
                    break;
                    
                case 'aki-stage3':
                    kidneyMesh.material.color.setHex(0x654321); // Very dark
                    kidneyMesh.material.opacity = 0.7;
                    nephronUnits.forEach(unit => {
                        unit.children[0].material.color.setHex(0xff2e2e); // Severely inflamed
                        unit.children[1].material.opacity = 0.7; // Very swollen
                        unit.children[2].material.color.setHex(0x1e1e1e); // Almost black tubules
                    });
                    break;
            }
        }

        function toggleRotation() {
            isRotating = !isRotating;
            event.target.textContent = isRotating ? 'Stop Rotation' : 'Start Rotation';
        }

        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.info-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Update button states
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function highlightStage(stage) {
            // Remove previous highlights
            document.querySelectorAll('.stage').forEach(s => s.classList.remove('pulse-animation'));
            
            // Add highlight to selected stage
            document.querySelectorAll('.stage')[stage - 1].classList.add('pulse-animation');
            
            // Update 3D model to show corresponding stage
            const stateMap = {
                1: 'aki-stage1',
                2: 'aki-stage2',
                3: 'aki-stage3'
            };
            
            // Simulate button click for stage
            document.querySelectorAll('.control-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.control-btn')[stage].classList.add('active');
            
            currentState = stateMap[stage];
            showKidneyState(currentState);
        }

        // Mouse interaction for 3D scene
        function addMouseControls() {
            const canvas = document.getElementById('kidney-canvas');
            let isMouseDown = false;
            let previousMousePosition = { x: 0, y: 0 };

            canvas.addEventListener('mousedown', (event) => {
                isMouseDown = true;
                previousMousePosition = { x: event.clientX, y: event.clientY };
            });

            canvas.addEventListener('mouseup', () => {
                isMouseDown = false;
            });

            canvas.addEventListener('mousemove', (event) => {
                if (!isMouseDown || !kidney) return;

                const deltaMove = {
                    x: event.clientX - previousMousePosition.x,
                    y: event.clientY - previousMousePosition.y
                };

                kidney.rotation.y += deltaMove.x * 0.01;
                kidney.rotation.x += deltaMove.y * 0.01;

                previousMousePosition = { x: event.clientX, y: event.clientY };
            });

            // Zoom with mouse wheel
            canvas.addEventListener('wheel', (event) => {
                event.preventDefault();
                const scale = event.deltaY > 0 ? 1.1 : 0.9;
                camera.position.multiplyScalar(scale);
                camera.position.clampLength(2, 20);
            });
        }

        // Educational interactions
        function createEducationalTooltips() {
            const canvas = document.getElementById('kidney-canvas');
            const tooltip = document.createElement('div');
            tooltip.style.cssText = `
                position: absolute;
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 10px;
                border-radius: 5px;
                font-size: 14px;
                pointer-events: none;
                z-index: 1000;
                display: none;
                max-width: 200px;
            `;
            document.body.appendChild(tooltip);

            canvas.addEventListener('mousemove', (event) => {
                const rect = canvas.getBoundingClientRect();
                const mouse = new THREE.Vector2(
                    ((event.clientX - rect.left) / rect.width) * 2 - 1,
                    -((event.clientY - rect.top) / rect.height) * 2 + 1
                );

                const raycaster = new THREE.Raycaster();
                raycaster.setFromCamera(mouse, camera);

                if (kidney) {
                    const intersects = raycaster.intersectObjects(kidney.children, true);
                    
                    if (intersects.length > 0) {
                        const object = intersects[0].object;
                        let tooltipText = '';

                        if (object.geometry instanceof THREE.ExtrudeGeometry) {
                            tooltipText = `Kidney Cortex: Contains nephrons that filter blood and produce urine. Current state: ${currentState.replace('-', ' ').toUpperCase()}`;
                        } else if (object.geometry instanceof THREE.SphereGeometry) {
                            if (object.material.color.getHex() === 0xff6b6b || object.material.color.getHex() === 0xff4757) {
                                tooltipText = 'Glomerulus: Network of tiny blood vessels where filtration begins';
                            } else {
                                tooltipText = "Bowman's Capsule: Cup-shaped structure surrounding the glomerulus";
                            }
                        } else if (object.geometry instanceof THREE.CylinderGeometry) {
                            tooltipText = 'Renal Tubule: Where filtered fluid is processed to form urine';
                        }

                        if (tooltipText) {
                            tooltip.style.display = 'block';
                            tooltip.style.left = event.clientX + 10 + 'px';
                            tooltip.style.top = event.clientY + 10 + 'px';
                            tooltip.textContent = tooltipText;
                        }
                    } else {
                        tooltip.style.display = 'none';
                    }
                }
            });

            canvas.addEventListener('mouseleave', () => {
                tooltip.style.display = 'none';
            });
        }

        // Initialize everything when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    init3DScene();
                    addMouseControls();
                    createEducationalTooltips();
                }, 500);
            }, 2000);
        });

        // Add keyboard shortcuts for better interaction
        document.addEventListener('keydown', (event) => {
            switch (event.key) {
                case '1':
                    showKidneyState('normal');
                    break;
                case '2':
                    showKidneyState('aki-stage1');
                    break;
                case '3':
                    showKidneyState('aki-stage2');
                    break;
                case '4':
                    showKidneyState('aki-stage3');
                    break;
                case ' ':
                    event.preventDefault();
                    toggleRotation();
                    break;
                case 'r':
                    // Reset camera position
                    camera.position.set(5, 3, 5);
                    camera.lookAt(0, 0, 0);
                    break;
            }
        });

        // Add performance monitoring
        let frameCount = 0;
        let lastTime = performance.now();
        
        function monitorPerformance() {
            frameCount++;
            const currentTime = performance.now();
            
            if (currentTime - lastTime >= 1000) {
                const fps = Math.round(frameCount * 1000 / (currentTime - lastTime));
                console.log(`FPS: ${fps}`);
                frameCount = 0;
                lastTime = currentTime;
            }
            
            requestAnimationFrame(monitorPerformance);
        }
        
        // Start performance monitoring in development
        if (window.location.hostname === 'localhost') {
            monitorPerformance();
        }
    </script>
</body>
</html>